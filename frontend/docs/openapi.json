{
  "openapi": "3.1.0",
  "info": {
    "title": "Vision RAG API",
    "version": "1.0.0"
  },
  "paths": {
    "/": {
      "get": {
        "tags": [
          "meta"
        ],
        "summary": "Root",
        "operationId": "root__get",
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {}
              }
            }
          }
        }
      }
    },
    "/health": {
      "get": {
        "tags": [
          "meta"
        ],
        "summary": "Health",
        "operationId": "health_health_get",
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {}
              }
            }
          }
        }
      }
    },
    "/version": {
      "get": {
        "tags": [
          "meta"
        ],
        "summary": "Version",
        "description": "Get the current version of the backend API.",
        "operationId": "version_version_get",
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {}
              }
            }
          }
        }
      }
    },
    "/search": {
      "get": {
        "tags": [
          "retrieval"
        ],
        "summary": "Search",
        "operationId": "search_search_get",
        "parameters": [
          {
            "name": "q",
            "in": "query",
            "required": true,
            "schema": {
              "type": "string",
              "description": "User query",
              "title": "Q"
            },
            "description": "User query"
          },
          {
            "name": "k",
            "in": "query",
            "required": false,
            "schema": {
              "anyOf": [
                {
                  "type": "integer",
                  "maximum": 50,
                  "minimum": 1
                },
                {
                  "type": "null"
                }
              ],
              "title": "K"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": {
                    "$ref": "#/components/schemas/SearchItem"
                  },
                  "title": "Response Search Search Get"
                }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/index": {
      "post": {
        "tags": [
          "indexing"
        ],
        "summary": "Index",
        "operationId": "index_index_post",
        "requestBody": {
          "content": {
            "multipart/form-data": {
              "schema": {
                "$ref": "#/components/schemas/Body_index_index_post"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {}
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/index/cancel/{job_id}": {
      "post": {
        "tags": [
          "indexing"
        ],
        "summary": "Cancel Upload",
        "description": "Cancel an ongoing upload/indexing job.",
        "operationId": "cancel_upload_index_cancel__job_id__post",
        "parameters": [
          {
            "name": "job_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "title": "Job Id"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {}
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/progress/stream/{job_id}": {
      "get": {
        "tags": [
          "indexing"
        ],
        "summary": "Stream Progress",
        "operationId": "stream_progress_progress_stream__job_id__get",
        "parameters": [
          {
            "name": "job_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "title": "Job Id"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {}
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/clear/qdrant": {
      "post": {
        "tags": [
          "maintenance"
        ],
        "summary": "Clear Qdrant",
        "operationId": "clear_qdrant_clear_qdrant_post",
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {}
              }
            }
          }
        }
      }
    },
    "/clear/minio": {
      "post": {
        "tags": [
          "maintenance"
        ],
        "summary": "Clear Minio",
        "operationId": "clear_minio_clear_minio_post",
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {}
              }
            }
          }
        }
      }
    },
    "/clear/all": {
      "post": {
        "tags": [
          "maintenance"
        ],
        "summary": "Clear All",
        "operationId": "clear_all_clear_all_post",
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {}
              }
            }
          }
        }
      }
    },
    "/status": {
      "get": {
        "tags": [
          "maintenance"
        ],
        "summary": "Get Status",
        "description": "Get the status of collection and bucket including statistics.",
        "operationId": "get_status_status_get",
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {}
              }
            }
          }
        }
      }
    },
    "/initialize": {
      "post": {
        "tags": [
          "maintenance"
        ],
        "summary": "Initialize",
        "description": "Initialize/create collection and bucket based on current configuration.",
        "operationId": "initialize_initialize_post",
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {}
              }
            }
          }
        }
      }
    },
    "/delete": {
      "delete": {
        "tags": [
          "maintenance"
        ],
        "summary": "Delete Collection And Bucket",
        "description": "Delete collection and bucket completely.",
        "operationId": "delete_collection_and_bucket_delete_delete",
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {}
              }
            }
          }
        }
      }
    },
    "/config/schema": {
      "get": {
        "tags": [
          "configuration"
        ],
        "summary": "Get Config Schema",
        "description": "Get the configuration schema with categories and settings.",
        "operationId": "get_config_schema_config_schema_get",
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "additionalProperties": true,
                  "type": "object",
                  "title": "Response Get Config Schema Config Schema Get"
                }
              }
            }
          }
        }
      }
    },
    "/config/values": {
      "get": {
        "tags": [
          "configuration"
        ],
        "summary": "Get Config Values",
        "description": "Get current values for all configuration variables.",
        "operationId": "get_config_values_config_values_get",
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "additionalProperties": {
                    "type": "string"
                  },
                  "type": "object",
                  "title": "Response Get Config Values Config Values Get"
                }
              }
            }
          }
        }
      }
    },
    "/config/update": {
      "post": {
        "tags": [
          "configuration"
        ],
        "summary": "Update Config",
        "description": "Update a configuration value at runtime.\n\nNote: This updates the runtime configuration immediately.\nTo persist changes across restarts, update your .env file manually.",
        "operationId": "update_config_config_update_post",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/ConfigUpdate"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "additionalProperties": true,
                  "type": "object",
                  "title": "Response Update Config Config Update Post"
                }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/config/reset": {
      "post": {
        "tags": [
          "configuration"
        ],
        "summary": "Reset Config",
        "description": "Reset all configuration to defaults from schema.\n\nNote: This only affects runtime values. Your .env file remains unchanged.",
        "operationId": "reset_config_config_reset_post",
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "additionalProperties": true,
                  "type": "object",
                  "title": "Response Reset Config Config Reset Post"
                }
              }
            }
          }
        }
      }
    },
    "/ocr/defaults": {
      "get": {
        "tags": [
          "ocr"
        ],
        "summary": "Get Defaults",
        "description": "Return the configured default values used when optional OCR fields are omitted.",
        "operationId": "get_defaults_ocr_defaults_get",
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/OCRDefaults"
                }
              }
            }
          }
        }
      }
    },
    "/ocr/health": {
      "get": {
        "tags": [
          "ocr"
        ],
        "summary": "Health",
        "description": "Surface the health status of the DeepSeek OCR service.",
        "operationId": "health_ocr_health_get",
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/OCRHealth"
                }
              }
            }
          }
        }
      }
    },
    "/ocr/info": {
      "get": {
        "tags": [
          "ocr"
        ],
        "summary": "Info",
        "description": "Expose metadata returned by the DeepSeek OCR service.",
        "operationId": "info_ocr_info_get",
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "additionalProperties": true,
                  "type": "object",
                  "title": "Response Info Ocr Info Get"
                }
              }
            }
          }
        }
      }
    },
    "/ocr/presets": {
      "get": {
        "tags": [
          "ocr"
        ],
        "summary": "Presets",
        "description": "Expose available profile and task presets from the OCR service.",
        "operationId": "presets_ocr_presets_get",
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/OCRPresets"
                }
              }
            }
          }
        }
      }
    },
    "/ocr/infer": {
      "post": {
        "tags": [
          "ocr"
        ],
        "summary": "Run Ocr",
        "description": "Proxy OCR requests to the DeepSeek OCR service with Snappy defaults.",
        "operationId": "run_ocr_ocr_infer_post",
        "requestBody": {
          "content": {
            "multipart/form-data": {
              "schema": {
                "$ref": "#/components/schemas/Body_run_ocr_ocr_infer_post"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/OCRResponse"
                }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    }
  },
  "components": {
    "schemas": {
      "Body_index_index_post": {
        "properties": {
          "files": {
            "items": {
              "type": "string",
              "format": "binary"
            },
            "type": "array",
            "title": "Files"
          }
        },
        "type": "object",
        "required": [
          "files"
        ],
        "title": "Body_index_index_post"
      },
      "Body_run_ocr_ocr_infer_post": {
        "properties": {
          "image": {
            "type": "string",
            "format": "binary",
            "title": "Image",
            "description": "Image to process."
          },
          "mode": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Mode",
            "description": "OCR mode (plain_ocr, markdown, tables_csv, etc.)."
          },
          "profile": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Profile",
            "description": "Profile preset controlling default sizing."
          },
          "prompt": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Prompt",
            "description": "Custom prompt for freeform mode."
          },
          "grounding": {
            "anyOf": [
              {
                "type": "boolean"
              },
              {
                "type": "null"
              }
            ],
            "title": "Grounding",
            "description": "Force grounding boxes regardless of selected mode."
          },
          "include_caption": {
            "anyOf": [
              {
                "type": "boolean"
              },
              {
                "type": "null"
              }
            ],
            "title": "Include Caption",
            "description": "Request an additional descriptive caption."
          },
          "find_term": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Find Term",
            "description": "Term to highlight for 'find_ref' mode."
          },
          "kv_schema": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Kv Schema",
            "description": "JSON schema used by 'kv_json' mode. Provide raw JSON text."
          },
          "base_size": {
            "anyOf": [
              {
                "type": "integer"
              },
              {
                "type": "null"
              }
            ],
            "title": "Base Size",
            "description": "Base resize dimension used by the OCR service."
          },
          "image_size": {
            "anyOf": [
              {
                "type": "integer"
              },
              {
                "type": "null"
              }
            ],
            "title": "Image Size",
            "description": "Image input size passed to the OCR service."
          },
          "crop_mode": {
            "anyOf": [
              {
                "type": "boolean"
              },
              {
                "type": "null"
              }
            ],
            "title": "Crop Mode",
            "description": "Enable crop mode during preprocessing."
          },
          "test_compress": {
            "anyOf": [
              {
                "type": "boolean"
              },
              {
                "type": "null"
              }
            ],
            "title": "Test Compress",
            "description": "Run compression diagnostics without saving artifacts."
          },
          "return_markdown": {
            "anyOf": [
              {
                "type": "boolean"
              },
              {
                "type": "null"
              }
            ],
            "title": "Return Markdown",
            "description": "Return markdown-formatted output from the OCR service."
          },
          "return_figures": {
            "anyOf": [
              {
                "type": "boolean"
              },
              {
                "type": "null"
              }
            ],
            "title": "Return Figures",
            "description": "Include base64-encoded figure crops extracted by the OCR service."
          }
        },
        "type": "object",
        "required": [
          "image"
        ],
        "title": "Body_run_ocr_ocr_infer_post"
      },
      "ConfigUpdate": {
        "properties": {
          "key": {
            "type": "string",
            "title": "Key",
            "description": "Environment variable name"
          },
          "value": {
            "type": "string",
            "title": "Value",
            "description": "New value"
          }
        },
        "type": "object",
        "required": [
          "key",
          "value"
        ],
        "title": "ConfigUpdate",
        "description": "Request model for updating configuration."
      },
      "HTTPValidationError": {
        "properties": {
          "detail": {
            "items": {
              "$ref": "#/components/schemas/ValidationError"
            },
            "type": "array",
            "title": "Detail"
          }
        },
        "type": "object",
        "title": "HTTPValidationError"
      },
      "OCRBoundingBox": {
        "properties": {
          "label": {
            "type": "string",
            "title": "Label"
          },
          "box": {
            "items": {
              "type": "integer"
            },
            "type": "array",
            "maxItems": 4,
            "minItems": 4,
            "title": "Box"
          }
        },
        "type": "object",
        "required": [
          "label",
          "box"
        ],
        "title": "OCRBoundingBox"
      },
      "OCRDefaults": {
        "properties": {
          "mode": {
            "type": "string",
            "title": "Mode"
          },
          "prompt": {
            "type": "string",
            "title": "Prompt"
          },
          "grounding": {
            "type": "boolean",
            "title": "Grounding"
          },
          "include_caption": {
            "type": "boolean",
            "title": "Include Caption"
          },
          "base_size": {
            "type": "integer",
            "title": "Base Size"
          },
          "image_size": {
            "type": "integer",
            "title": "Image Size"
          },
          "crop_mode": {
            "type": "boolean",
            "title": "Crop Mode"
          },
          "test_compress": {
            "type": "boolean",
            "title": "Test Compress"
          },
          "profile": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Profile"
          },
          "return_markdown": {
            "type": "boolean",
            "title": "Return Markdown"
          },
          "return_figures": {
            "type": "boolean",
            "title": "Return Figures"
          }
        },
        "type": "object",
        "required": [
          "mode",
          "prompt",
          "grounding",
          "include_caption",
          "base_size",
          "image_size",
          "crop_mode",
          "test_compress",
          "profile",
          "return_markdown",
          "return_figures"
        ],
        "title": "OCRDefaults"
      },
      "OCRFigure": {
        "properties": {
          "index": {
            "type": "integer",
            "title": "Index"
          },
          "label": {
            "type": "string",
            "title": "Label"
          },
          "box": {
            "items": {
              "type": "integer"
            },
            "type": "array",
            "maxItems": 4,
            "minItems": 4,
            "title": "Box"
          },
          "data_uri": {
            "type": "string",
            "title": "Data Uri"
          }
        },
        "type": "object",
        "required": [
          "index",
          "label",
          "box",
          "data_uri"
        ],
        "title": "OCRFigure"
      },
      "OCRHealth": {
        "properties": {
          "enabled": {
            "type": "boolean",
            "title": "Enabled"
          },
          "healthy": {
            "type": "boolean",
            "title": "Healthy"
          },
          "model_loaded": {
            "anyOf": [
              {
                "type": "boolean"
              },
              {
                "type": "null"
              }
            ],
            "title": "Model Loaded"
          },
          "device": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Device"
          }
        },
        "type": "object",
        "required": [
          "enabled",
          "healthy"
        ],
        "title": "OCRHealth"
      },
      "OCRMetadata": {
        "properties": {
          "mode": {
            "type": "string",
            "title": "Mode",
            "description": "OCR mode used for the request."
          },
          "grounding": {
            "type": "boolean",
            "title": "Grounding",
            "description": "Whether grounding boxes were enabled for the request."
          },
          "base_size": {
            "type": "integer",
            "title": "Base Size",
            "description": "Base resize dimension passed to the model."
          },
          "image_size": {
            "type": "integer",
            "title": "Image Size",
            "description": "Image size parameter passed to the model."
          },
          "crop_mode": {
            "type": "boolean",
            "title": "Crop Mode",
            "description": "Crop mode flag used during inference."
          },
          "include_caption": {
            "type": "boolean",
            "title": "Include Caption",
            "description": "Whether captions were requested."
          },
          "elapsed_ms": {
            "anyOf": [
              {
                "type": "integer"
              },
              {
                "type": "null"
              }
            ],
            "title": "Elapsed Ms",
            "description": "Elapsed time reported by the OCR service in milliseconds."
          },
          "profile": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Profile",
            "description": "Profile preset applied to derive sizing defaults."
          },
          "attention": {
            "type": "string",
            "title": "Attention",
            "description": "Attention implementation used by the model."
          }
        },
        "type": "object",
        "required": [
          "mode",
          "grounding",
          "base_size",
          "image_size",
          "crop_mode",
          "include_caption",
          "attention"
        ],
        "title": "OCRMetadata"
      },
      "OCRPresets": {
        "properties": {
          "profiles": {
            "items": {
              "$ref": "#/components/schemas/OCRProfilePreset"
            },
            "type": "array",
            "title": "Profiles"
          },
          "tasks": {
            "items": {
              "$ref": "#/components/schemas/OCRTaskPreset"
            },
            "type": "array",
            "title": "Tasks"
          }
        },
        "type": "object",
        "required": [
          "profiles",
          "tasks"
        ],
        "title": "OCRPresets"
      },
      "OCRProfilePreset": {
        "properties": {
          "key": {
            "type": "string",
            "title": "Key"
          },
          "label": {
            "type": "string",
            "title": "Label"
          },
          "description": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Description"
          },
          "base_size": {
            "anyOf": [
              {
                "type": "integer"
              },
              {
                "type": "null"
              }
            ],
            "title": "Base Size"
          },
          "image_size": {
            "anyOf": [
              {
                "type": "integer"
              },
              {
                "type": "null"
              }
            ],
            "title": "Image Size"
          },
          "crop_mode": {
            "anyOf": [
              {
                "type": "boolean"
              },
              {
                "type": "null"
              }
            ],
            "title": "Crop Mode"
          },
          "aliases": {
            "items": {
              "type": "string"
            },
            "type": "array",
            "title": "Aliases"
          }
        },
        "type": "object",
        "required": [
          "key",
          "label"
        ],
        "title": "OCRProfilePreset"
      },
      "OCRResponse": {
        "properties": {
          "success": {
            "type": "boolean",
            "title": "Success",
            "default": true
          },
          "text": {
            "type": "string",
            "title": "Text"
          },
          "raw_text": {
            "type": "string",
            "title": "Raw Text"
          },
          "markdown": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Markdown"
          },
          "boxes": {
            "items": {
              "$ref": "#/components/schemas/OCRBoundingBox"
            },
            "type": "array",
            "title": "Boxes"
          },
          "figures": {
            "items": {
              "$ref": "#/components/schemas/OCRFigure"
            },
            "type": "array",
            "title": "Figures"
          },
          "image_dims": {
            "additionalProperties": {
              "anyOf": [
                {
                  "type": "integer"
                },
                {
                  "type": "null"
                }
              ]
            },
            "type": "object",
            "title": "Image Dims"
          },
          "metadata": {
            "$ref": "#/components/schemas/OCRMetadata"
          }
        },
        "type": "object",
        "required": [
          "text",
          "raw_text",
          "boxes",
          "image_dims",
          "metadata"
        ],
        "title": "OCRResponse"
      },
      "OCRTaskPreset": {
        "properties": {
          "key": {
            "type": "string",
            "title": "Key"
          },
          "label": {
            "type": "string",
            "title": "Label"
          },
          "description": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Description"
          },
          "requires_grounding": {
            "type": "boolean",
            "title": "Requires Grounding",
            "default": false
          },
          "aliases": {
            "items": {
              "type": "string"
            },
            "type": "array",
            "title": "Aliases"
          }
        },
        "type": "object",
        "required": [
          "key",
          "label"
        ],
        "title": "OCRTaskPreset"
      },
      "SearchItem": {
        "properties": {
          "image_url": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Image Url"
          },
          "label": {
            "anyOf": [
              {
                "type": "string"
              },
              {
                "type": "null"
              }
            ],
            "title": "Label"
          },
          "payload": {
            "additionalProperties": true,
            "type": "object",
            "title": "Payload"
          },
          "score": {
            "anyOf": [
              {
                "type": "number"
              },
              {
                "type": "null"
              }
            ],
            "title": "Score"
          }
        },
        "type": "object",
        "required": [
          "image_url",
          "label",
          "payload"
        ],
        "title": "SearchItem"
      },
      "ValidationError": {
        "properties": {
          "loc": {
            "items": {
              "anyOf": [
                {
                  "type": "string"
                },
                {
                  "type": "integer"
                }
              ]
            },
            "type": "array",
            "title": "Location"
          },
          "msg": {
            "type": "string",
            "title": "Message"
          },
          "type": {
            "type": "string",
            "title": "Error Type"
          }
        },
        "type": "object",
        "required": [
          "loc",
          "msg",
          "type"
        ],
        "title": "ValidationError"
      }
    }
  }
}